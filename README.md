Документация проекта: Система регистрации/авторизации (Python + SQLite + HTTP + Tkinter)

Этот проект показывает базовую логику:

-регистрация пользователя;

-вход (логин) и получение токена;

-выход (логаут) и инвалидирование токена;

-получение профиля по токену;

-простая авторизация по роли (user / admin);

-GUI-клиент с формами регистрации и входа;

Чтобы избежать проблем с зависимостями, проект сделан без сторонних библиотек: используется только стандартная библиотека Python.

1) Структура проекта
mini_auth_app/
  server.py;
  client_gui.py;
  start_server.bat;
  start_client.bat;
  app.db          (создастся автоматически после запуска сервера)

2) Требования

Windows

Python 3.10+ (подойдёт и 3.8+, но лучше свежее)


3. Развёртывание и запуск
3.1. Запуск сервера

Откройте папку проекта.

Запустите start_server.bat двойным кликом.

После запуска сервер будет доступен по адресу:

http://127.0.0.1:8000

При первом запуске автоматически создаётся администратор:

login: admin

password: admin123

При необходимости в .bat можно указать полный путь к интерпретатору Python вместо команды python.

3.2. Запуск графического клиента

Убедитесь, что сервер запущен.

Запустите start_client.bat двойным кликом.

Окно клиента содержит:

вкладку Register — регистрация пользователя;

вкладку Login / Profile — вход/выход, запрос профиля /me, запрос админского списка пользователей.

4. Общее описание архитектуры

Проект состоит из двух компонентов:

Backend-сервер (server.py)
HTTP-сервер на базе http.server, хранение данных в SQLite (sqlite3).

GUI-клиент (client_gui.py)
Клиентское приложение на tkinter, взаимодействует с сервером по HTTP.

5. Хранение данных (SQLite)

Файл базы данных:

app.db (создаётся автоматически)

Таблицы:

users — пользователи:

login (уникальный)

pass_hash (хэш пароля, пароль в открытом виде не хранится)

first_name, last_name

role (user или admin)

sessions — активные сессии (токены):

token

user_id

expire_at (время истечения токена)

6. Регистрация и аутентификация

6.1. Регистрация (POST /register)

Клиент передаёт:

login

password

password2

first_name (опционально)

last_name (опционально)

Сервер выполняет:

проверку заполненности обязательных полей;

проверку совпадения password и password2;

проверку уникальности login;

создание хэша пароля и сохранение пользователя с ролью user.

Пароли хэшируются с использованием:

hashlib.pbkdf2_hmac("sha256", ...)

индивидуальной соли для каждого пользователя

6.2. Вход (POST /login)

Клиент передаёт:

login

password

Сервер выполняет:

поиск пользователя в таблице users;

проверку пароля сравнением хэша;

создание токена (UUID) и запись в таблицу sessions с TTL.

7. Работа с токеном (сессия)

После успешного входа клиент использует токен в заголовке:

Authorization: Token <token>

На стороне сервера токен:

проверяется на наличие в таблице sessions;

проверяется на истечение времени (expire_at);

связывается с пользователем через user_id.

Если токен отсутствует/некорректен/истёк:

возвращается 401 Unauthorized.

Выход (POST /logout)

Сервер удаляет токен из таблицы sessions. После этого токен становится недействительным.

8. Авторизация по роли

Роли:

user — стандартный пользователь (назначается при регистрации);

admin — администратор (создаётся автоматически при первом запуске).

Принцип:

эндпоинты, требующие входа, возвращают 401, если токен отсутствует или невалиден;

эндпоинты, требующие роль admin, возвращают 403 Forbidden, если роль пользователя не admin.

9. Доступные HTTP-эндпоинты
Общие

GET / — проверка работоспособности сервера + список эндпоинтов

POST /register — регистрация

POST /login — вход и получение токена

POST /logout — выход (инвалидация токена)

GET /me — данные текущего пользователя (требуется токен)

Административные

GET /admin/users — список пользователей (требуется роль admin)

10. Типовые ошибки и диагностика

Клиент сообщает “Server not reachable”

убедитесь, что запущен start_server.bat;

проверьте доступность http://127.0.0.1:8000 в браузере.

Сервер не запускается

возможна занятость порта 8000 другим приложением;

убедитесь, что запуск выполняется из папки проекта.

11. Примечания

Так как это мой первый оптыт в создании подобных приложений, я не смог выполнить все поставленные задачи.
Поэтому проект является минимальной реализацией. Для промышленного использования потребуются дополнительные меры:

HTTPS;

защита от перебора паролей;

расширенная модель прав доступа;

аудит и логирование.


Но в любом случае это было гораздо интереснее чем решать однообразные задачи на LeetCode.
